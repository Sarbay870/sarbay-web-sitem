{% extends "layout.html" %}

{% block content %}
    
<!-- === üëë KRAL G√úNCELLEMESƒ∞: EKSƒ∞K OLAN MODAL PENCERE STƒ∞LLERƒ∞ EKLENDƒ∞ üëë === -->
<style>
    /* Modal Arka Planƒ± */
    .modal-overlay {
        display: none; /* Ba≈ülangƒ±√ßta gizli */
        position: fixed; /* Sayfa kaysa bile yerinde kal */
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto; /* Gerekirse scroll et */
        background-color: rgba(0,0,0,0.5); /* Yarƒ± ≈üeffaf siyah */
        /* Ortalamak i√ßin flex */
        display: none;
        align-items: center;
        justify-content: center;
    }

    /* Modal ƒ∞√ßerik Kutusu */
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 25px;
        border: 1px solid #888;
        width: 90%;
        max-width: 500px; /* √áok geni≈ülemesin */
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        position: relative;
    }

    /* Kapatma Butonu (X) */
    .modal-close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        top: 10px;
        right: 15px;
    }
    .modal-close:hover,
    .modal-close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    
    /* Form elemanlarƒ± i√ßin stiller */
    .modal-content .form-group {
        margin-bottom: 15px;
    }
    .modal-content .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
    }
    .modal-content .form-group input[type="text"],
    .modal-content .form-group input[type="date"],
    .modal-content .form-group select,
    .modal-content .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box; /* Padding'i hesaba kat */
    }
    .modal-content .btn-modal-submit {
        display: block;
        width: 100%;
        padding: 12px;
        font-size: 16px;
    }
</style>
<!-- === üëë STƒ∞LLER Bƒ∞TTƒ∞ üëë === -->


    <!-- 1. Kar≈üƒ±lama Mesajƒ± -->
    <h1>{{ selamlama_mesaji }}</h1>
    
    <hr>
    
    <!-- 2. Yakla≈üan Sƒ±navlar -->
    <div class="card" id="sinavlar-card">
        <div class="card-header">
            <h2>Yakla≈üan Sƒ±navlar</h2>
            <div class="header-actions">
                {% if sinav_listesi %}
                    <button class="btn btn-small btn-delete toggle-delete-mode-btn">Sil</button>
                {% endif %}
                <!-- === üëë HATA D√úZELTMESƒ∞ (1/4): Class adƒ± deƒüi≈üti üëë === -->
                <!-- Bu buton "sinav-modal" ID'li pencereyi a√ßacak -->
                <button class="btn btn-small btn-add kral-sinav-ac-btn">Ekle</button>
            </div>
        </div>
        
        <div class="list-group">
            {% if sinav_listesi %}
                {% for sinav in sinav_listesi %}
                    <div class="list-group-item" data-id="{{ sinav.id }}">
                        <span>
                            <strong>{{ sinav.ad }}</strong> - 
                            {% if sinav.kalan_gun == 0 %}
                                BUG√úN! üî•
                            {% else %}
                                {{ sinav.kalan_gun }} g√ºn kaldƒ±
                            {% endif %}
                        </span>
                        <!-- Silme ikonu (Silme modu aktifken JS ile g√∂r√ºn√ºr yapƒ±lƒ±r) -->
                        <a href="{{ url_for('sil_sinav', sinav_id=sinav.id) }}" class="delete-icon" aria-label="Sƒ±navƒ± Sil">‚õîÔ∏è</a>
                    </div>
                {% endfor %}
            {% else %}
                <div class="card-content">
                    <p class="yok">Yakla≈üan sƒ±nav kaydƒ± yok.
                        <!-- === üëë HATA D√úZELTMESƒ∞ (2/4): Class adƒ± deƒüi≈üti üëë === -->
                        <!-- Bu link "sinav-modal" ID'li pencereyi a√ßacak -->
                        <a href="#" class="btn-inline-add kral-sinav-ac-btn">≈ûimdi Ekle</a>
                    </p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 3. √áalƒ±≈üma Takibi (Deƒüi≈üiklik yok) -->
    <div class="card" id="calisma-card">
        <div class="card-header">
            <h2>√áalƒ±≈üma Takibi</h2>
            <div class="header-actions">
                {% if calisma_listesi %}
                    <button class="btn btn-small btn-delete toggle-delete-mode-btn">Sil</button>
                {% endif %}
                <a href="{{ url_for('calisma_takibi_sayfasi') }}" class="btn btn-small btn-add">Ekle</a>
            </div>
        </div>
        
        <div class="list-group">
            {% if calisma_listesi %}
                {% for calisma in calisma_listesi %}
                    <div class="list-group-item" data-id="{{ calisma.id }}">
                        <span>{{ calisma.text }}</span>
                        <a href="{{ url_for('sil_calisma', calisma_id=calisma.id) }}" class="delete-icon" aria-label="√áalƒ±≈ümayƒ± Sil">‚õîÔ∏è</a>
                    </div>
                {% endfor %}
            {% else %}
                <div class="card-content">
                    <p class="yok">√áalƒ±≈üma takibi eklemedin.
                        <a href="{{ url_for('calisma_takibi_sayfasi') }}" class="btn-inline-add">≈ûimdi Ekle</a>
                    </p>
                </div>
            {% endif %}
        </div>
    </div>

   <!-- 4. Notlar -->
    <div class="card" id="notlar-card">
        <div class="card-header">
            <h2>Notlar</h2>
            <div class="header-actions">
                {% if not_listesi %}
                    <button class="btn btn-small btn-delete toggle-delete-mode-btn">Sil</button>
                {% endif %}
                <!-- === üëë HATA D√úZELTMESƒ∞ (3/4): Class adƒ± deƒüi≈üti üëë === -->
                <!-- Bu buton "not-modal" ID'li pencereyi a√ßacak -->
                <button class="btn btn-small btn-add kral-not-ac-btn">Ekle</button>
            </div>
        </div>
        
        <div class="list-group">
            {% if not_listesi %}
                {% for not_ in not_listesi %}
                    <div class="list-group-item" data-id="{{ not_.id }}">
                        <span>{{ not_.text }}</span>
                        <a href="{{ url_for('sil_not', not_id=not_.id) }}" class="delete-icon" aria-label="Notu Sil">‚õîÔ∏è</a>
                    </div>
                {% endfor %}
            {% else %}
                <div class="card-content">
                    <p class="yok">Kayƒ±tlƒ± notun yok.
                        <!-- === üëë HATA D√úZELTMESƒ∞ (4/4): Class adƒ± deƒüi≈üti üëë === -->
                        <!-- Bu link "not-modal" ID'li pencereyi a√ßacak -->
                        <a href="#" class="btn-inline-add kral-not-ac-btn">≈ûimdi Ekle</a>
                    </p>
                </div>
            {% endif %}
        </div>
    </div>


<!-- === "SINAV EKLE" MODALI (Deƒüi≈üiklik yok) === -->
<div id="sinav-modal" class="modal-overlay">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h2>Yeni Sƒ±nav Ekle</h2>
        
        <form method="POST" action="{{ url_for('ekle_sinav') }}">
            
            <div class="form-group">
                <label for="sinav_adi_select">Sƒ±nav Adƒ±:</label>
                <select id="sinav_adi_select" name="sinav_adi" required>
                    <option value="" disabled selected>-- Ders Se√ßin --</option>
                    {% if global_ders_listesi %}
                        {% for ders in global_ders_listesi %}
                            <option value="{{ ders }}">{{ ders }}</option>
                        {% endfor %}
                    {% else %}
                        <option value="" disabled>Ders bulunamadƒ± (app.py'yi kontrol et)</option>
                    {% endif %}
                    <option value="Diƒüer">Diƒüer (Manuel Gir)</option>
                </select>
                
                <input type="text" id="sinav_adi_manual" name="sinav_adi_manual" placeholder="Sƒ±nav adƒ±nƒ± buraya yazƒ±n..." style="margin-top: 10px; display: none;">
            </div>

            <div class="form-group">
                 <label for="sinav_tarihi_input">Tarih:</label>
                <input id="sinav_tarihi_input" type="date" name="sinav_tarihi" required>
            </div>
            
            <button type="submit" class="btn btn-add btn-modal-submit">Sƒ±navƒ± Kaydet</button>
        </form>
    </div>
</div>
<!-- === SINAV MODALI Bƒ∞TTƒ∞ === -->


<!-- === "NOT EKLE" MODALI (Deƒüi≈üiklik yok) === -->
<div id="not-modal" class="modal-overlay">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h2>Yeni Not Ekle</h2>
        
        <form method="POST" action="{{ url_for('ekle_not') }}">
            <div class="form-group">
                <label for="not_text_area">Notunuz:</label>
                <textarea id="not_text_area" name="not_text" rows="5" placeholder="Hƒ±zlƒ± notunuzu buraya yazƒ±n..." required></textarea>
            </div>
            <button type="submit" class="btn btn-add btn-modal-submit">Notu Kaydet</button>
        </form>
    </div>
</div>
<!-- === NOT MODALI Bƒ∞TTƒ∞ === -->


<!-- === üëë KRAL G√úNCELLEMESƒ∞: MODAL'LARI √áALI≈ûTIRAN JAVASCRIPT üëë === -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Modal Temel √áalƒ±≈ütƒ±rma Mantƒ±ƒüƒ± ---
        const sinavModal = document.getElementById('sinav-modal');
        const notModal = document.getElementById('not-modal');
        const modals = [sinavModal, notModal];
        const closeButtons = document.querySelectorAll('.modal-close');

        // === üëë HATA D√úZELTMESƒ∞: Artƒ±k yeni class adƒ±nƒ± dinliyor üëë ===
        // "Sƒ±nav Ekle" butonlarƒ±nƒ± (.kral-sinav-ac-btn) bul ve modalƒ± a√ß
        document.querySelectorAll('.kral-sinav-ac-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault(); // Linkin tƒ±klamasƒ±nƒ± engelle
                sinavModal.style.display = 'flex'; // flex (ortalamak i√ßin)
            });
        });

        // === üëë HATA D√úZELTMESƒ∞: Artƒ±k yeni class adƒ±nƒ± dinliyor üëë ===
        // "Not Ekle" butonlarƒ±nƒ± (.kral-not-ac-btn) bul ve modalƒ± a√ß
        document.querySelectorAll('.kral-not-ac-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                notModal.style.display = 'flex';
            });
        });

        // Kapatma (X) butonlarƒ±na tƒ±klandƒ±ƒüƒ±nda
        closeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.modal-overlay').style.display = 'none';
            });
        });

        // Arka plana (overlay) tƒ±klandƒ±ƒüƒ±nda
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.style.display = 'none';
            }
        });

        // --- Sƒ±nav ComboBox "Diƒüer" se√ßeneƒüi JS ---
        // (Bu kod doƒüru, dokunulmadƒ±)
        const select = document.getElementById('sinav_adi_select');
        const manualInput = document.getElementById('sinav_adi_manual');
        const sinavForm = select.closest('form');

        if (select) { 
            select.addEventListener('change', function() {
                if (this.value === 'Diƒüer') {
                    manualInput.style.display = 'block';
                    manualInput.setAttribute('name', 'sinav_adi'); 
                    select.removeAttribute('name'); 
                    manualInput.focus();
                } else {
                    manualInput.style.display = 'none';
                    manualInput.removeAttribute('name');
                    select.setAttribute('name', 'sinav_adi'); 
                }
            });

            if (sinavForm) {
                sinavForm.addEventListener('submit', function(e) {
                    if (select.value === 'Diƒüer' && manualInput.value.trim() === '') {
                        e.preventDefault(); 
                        manualInput.style.borderColor = 'red';
                    }
                });
            }
        }
        
        // --- Silme Modu Toggle Mantƒ±ƒüƒ± ---
        // (Bu kod doƒüru, dokunulmadƒ±)
        document.querySelectorAll('.toggle-delete-mode-btn').forEach(button => {
            button.addEventListener('click', function() {
                const card = this.closest('.card');
                const deleteIcons = card.querySelectorAll('.delete-icon');
                
                deleteIcons.forEach(icon => {
                    icon.style.display = (icon.style.display === 'inline' ? 'none' : 'inline');
                });
            });
        });

    });
</script>
<!-- === üëë JAVASCRIPT Bƒ∞TTƒ∞ üëë === -->

{% endblock %}